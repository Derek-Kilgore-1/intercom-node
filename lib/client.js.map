{"version":3,"sources":["../../lib/client.ts"],"names":[],"mappings":"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","file":"client.js","sourcesContent":["import { deprecate } from 'util';\nimport User from './user';\nimport Event from './event';\nimport Company from './company';\nimport Contact from './contact';\nimport Visitor from './visitor';\nimport Counts from './counts';\nimport Admin from './admin';\nimport Tag from './tag';\nimport Segment from './segment';\nimport Message from './message';\nimport Conversation from './conversation';\nimport Note from './note';\nimport Customer from './customer';\n\nimport axios, { Axios, AxiosDefaults, AxiosResponse } from 'axios';\nimport {merge, omit} from 'lodash'\n\nimport { BadResponseError } from './errors/badResponse.error';\n\ninterface IRequestOptions {\n  url: string;\n  data?: any;\n  params?: any\n}\n\nexport default class Client {\n  axiosInstance: Axios;\n  usernamePart?: string;\n  passwordPart?: string;\n  users: any;\n  events: any;\n  companies: any;\n  contacts: Contact;\n  leads: any;\n  visitors: any;\n  counts: any;\n  admins: any;\n  tags: any;\n  segments: any;\n  messages: any;\n  conversations: Conversation;\n  notes: any;\n  customers: any;\n  requestOpts: Partial<AxiosDefaults>;\n  usebaseURL: (baseURL: any) => this;\n  propertiesToOmitInRequestOpts: string[];\n\n  // TO-DO: Fix any\n  constructor(...args: any) {\n    // TO-DO: Refactor it!\n    if (args.length === 2) {\n      this.usernamePart = args[0];\n      this.passwordPart = args[1];\n    } else if (args.length === 1) {\n      if (args[0].token) {\n        this.usernamePart = args[0].token;\n        this.passwordPart = '';\n      } else {\n        this.usernamePart = args[0].appId;\n        this.passwordPart = args[0].appApiKey;\n      }\n    }\n    if (!this.usernamePart || this.passwordPart === undefined) {\n      throw new Error('Could not construct a client with those parameters');\n    }\n    this.users = new User(this);\n    this.events = new Event(this);\n    this.companies = new Company(this);\n    this.contacts = new Contact(this);\n    this.leads = new Contact(this);\n    this.visitors = new Visitor(this);\n    this.counts = new Counts(this);\n    this.admins = new Admin(this);\n    this.tags = new Tag(this);\n    this.segments = new Segment(this);\n    this.messages = new Message(this);\n    this.conversations = new Conversation(this);\n    this.notes = new Note(this);\n    this.customers = new Customer(this);\n    this.requestOpts = {\n      baseURL: 'https://api.intercom.io'\n    };\n    this.propertiesToOmitInRequestOpts = ['headers.common.Accept'];\n\n    this.usebaseURL = deprecate(baseURL => this.useRequestOpts({ baseURL }), 'intercom-client - client.usebaseURL(url): Use client.useRequestOpts({ baseURL: url }) instead');\n\n    this.axiosInstance = this.initiateAxiosInstance();\n  }\n  initiateAxiosInstance(): Axios {\n    // TO-DO: Revise the params\n    const defaultHeaders = {\n      'User-Agent': 'intercom-node-client/2.0.0',\n      Accept: 'application/json'\n    };\n\n    const axiosInstance = axios.create({auth: {username: this.usernamePart as string, password: this.passwordPart as string}, baseURL: this.requestOpts.baseURL});\n\n    axiosInstance.defaults.headers.common = merge(axiosInstance.defaults.headers.common, defaultHeaders);\n\n    return axiosInstance;\n  }\n\n  useRequestOpts(opts: Partial<AxiosDefaults>) {\n    const filteredOpts = this.filterUnwantedProperties(opts);\n\n    this.requestOpts = merge(this.requestOpts, filteredOpts);\n    this.updateAxiosInstanceDefaults();\n\n    return this;\n  }\n\n  updateAxiosInstanceDefaults(): void {\n    this.axiosInstance.defaults = merge(this.axiosInstance.defaults, this.requestOpts);\n  }\n\n  filterUnwantedProperties(opts: Partial<AxiosDefaults>): Partial<AxiosDefaults> {\n    return omit(opts, this.propertiesToOmitInRequestOpts);\n  }\n\n  async ping<T>(): Promise<T> {\n    try {\n      const response = await this.axiosInstance.get('/admins');\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  async put<T>({url, data}: IRequestOptions): Promise<T> {\n    try {\n      const response = await this.axiosInstance.put(url, data);\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  async post<T>({url, data}: IRequestOptions): Promise<T> {\n    try {\n      const response = await this.axiosInstance.post(url, data);\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  async get<T>({url, data}: IRequestOptions): Promise<T> {\n    try {\n      const response = await this.axiosInstance.get(url, {params: data});\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  async nextPage<T>(paginationObject: {next: string}): Promise<T> {\n    try {\n      const response = await this.axiosInstance.get(paginationObject.next, {baseURL: undefined});\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  async delete<T>({url, data, params}: IRequestOptions): Promise<T> {\n    try {\n      const response = await this.axiosInstance.delete(url, {data, params});\n\n      return response.data;\n    }\n    catch(err) {\n      const error = err.response ? this.checkOnErrorInResponse(err.response) : err;\n\n      throw error;\n    }\n  }\n\n  private checkOnErrorInResponse({data, headers, status}: AxiosResponse): Error | undefined {\n    if (data.type !== 'error.list') {\n      return undefined;\n    }\n\n    const message = Array.isArray(data.errors) && data.errors[0].message ? data.errors[0].message : null;\n    return new BadResponseError(message || 'Response error', data, headers, status);\n  }\n}\n"]}